<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8"/>
	<title>用户管理</title>
	<link th:href="@{/static/bootstrap/css/bootstrap.min.css}" media="screen" rel="stylesheet" type="text/css"/>
	<link th:href="@{/static/bootstrap/css/bootstrap-theme.min.css}" media="screen" rel="stylesheet" type="text/css"/>
	<script th:src="@{/static/jquery/jquery.min.js}" type="text/javascript"></script>
	<script th:src="@{/static/bootstrap/js/bootstrap.min.js}" type="text/javascript"></script>
	<script th:inline="javascript" type="text/javascript">
		$(function () {
			$('#reload').click(function () {
				var getAllUserUrl = /*[[@{/user/getAllUser/}]]*/
					$.get(getAllUserUrl, function (data) {
						if (data.status == 200) {
							var userList = data.data;
							$('#tableTbody').html('');
							for (var i = 0; i < userList.length; i++) {
								var user = userList[i];
								$('#tableTbody').append("<tr><td>" + user.userName + "</td><td>" + user.age + "</td><td>"
									+ user.sex + "</td><td><button type='button' class='btn btn-danger'" +
									" onclick='\"deleteUser(" + user.id + ")\"'>删除</button><button type='button'" +
									" class='btn btn-info' onclick='\"updateUser(" + user.id + ")\"'>编辑</button></td></tr>");
							}
						} else {
							$('#warningAlert span').text("获取用户信息失败!");
							$('#warningAlert').removeClass('hide');
							setTimeout('$("#warningAlert").addClass("hide")', 5000);
						}
					});
			});
			$('#addUser').click(function () {

			});
		});

		function deleteUser(id) {
			$('#okModal').modal({
				keyboard: true
			}).on('hide.bs.modal',
				function () {
					$("#okDelUser").unbind("click");
				});
			$('#okDelUser').bind("click", function () {
				var delUserUrl = /*[[@{/user/delUser/}]]*/
					delUserUrl += id;
				$.ajax({
					type: 'GET',
					url: delUserUrl,
					async: false,
					cache: false,
					dataType: 'json',
					success: function (data) {
						if (data.status == 200) {
							$('#successAlert span').text(data.message);
							$('#successAlert').removeClass('hide');
							setTimeout('$("#successAlert").addClass("hide")', 5000);
						} else {
							$('#warningAlert span').text(data.message);
							$('#warningAlert').removeClass('hide');
							setTimeout('$("#warningAlert").addClass("hide")', 5000);
						}
					}
				});
				$('#okModal').modal('hide');
			});
		}

		function updateUser(id) {

		}
	</script>
</head>
<body>
<div class="container">
	<h2>用户查询</h2>
	<button type="button" class="btn btn-default" id="reload">刷新</button>
	<button type="button" class="btn btn-primary" id="addUser">添加用户</button>
	<table class="table table-bordered table-condensed">
		<thead>
		<tr>
			<th>用户名</th>
			<th>年龄</th>
			<th>性别</th>
			<th>操作</th>
		</tr>
		</thead>
		<tbody id="tableTbody">
		<tr th:each="user,userStat:${users}">
			<td th:text="${user.userName}"></td>
			<td th:text="${user.age}"></td>
			<td th:text="${user.sex eq 'M' ? '男' : '女'}"></td>
			<td>
				<button type="button" class="btn btn-danger" th:onclick="'deleteUser(' + ${user.id} + ')'">删除</button>
				<button type="button" class="btn btn-info" th:onclick="'updateUser(' + ${user.id} + ')'">编辑</button>
			</td>
		</tr>
		</tbody>
	</table>
</div>

<div class="modal fade" id="okModal" tabindex="-1" role="dialog" aria-labelledby="okModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
				<h4 class="modal-title" id="okModalLabel">确认框</h4>
			</div>
			<div class="modal-body">确定要删除这条记录吗?</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
				<button type="button" class="btn btn-danger" id="okDelUser">确定</button>
			</div>
		</div>
	</div>
</div>

<div id="successAlert" class="alert alert-success fade in hide">
	<strong>成功！</strong><span></span>
</div>
<div id="warningAlert" class="alert alert-warning fade in hide">
	<strong>警告！</strong><span></span>
</div>

</body>
</html>